<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head"></head>
<body>

<div th:replace="fragments/navbar :: navbar('workouts')">Navbar here</div>

<div class="container mt-4">
    <div th:object="${workout}"
         th:each="workout : ${workouts}"
         class="my-3 border-secondary card">
        <div class="card-header">
            <div class="d-flex justify-content-between">
                <div class="col-10">
                    <span th:text="*{exerciseName}">Exercise Name</span>
                </div>
            </div>
        </div>
        <!-- Таймер: Потребителят може да настрои време -->
        <div>
            <h4>Настрой време за почивка</h4>
            <input type="number" id="minutesInput" value="2" min="0" max="60" /> минути
            <input type="number" id="secondsInput" value="0" min="0" max="59" /> секунди
            <button id="startTimerButton" class="btn btn-outline-primary" onclick="startTimer()">Започни Таймер</button>
        </div>

        <!-- Таймерът се показва тук -->
        <span>Rest Timer: <strong id="restTimer">2min 0s</strong></span>
        <span>
                <button class="btn btn-outline-danger">Discard Workout</button>
            </span>
    </div>

    <!-- Series Table -->
    <div class="workout-series">
        <div class="workout-row">
            <span>SET</span>
            <span>Тежест (kg)</span>
            <span>Повторения (Reps)</span>
            <span>RPE</span>
            <span>Действие</span>
        </div>

        <div th:each="set : ${sets}" class="workout-row">
            <input type="number" th:value="${set.number}" disabled />
            <input type="number" th:value="${set.weight}" />
            <input type="number" th:value="${set.reps}" />
            <input type="number" th:value="${set.rpe}" />
            <span class="delete-button" th:onclick="|deleteSet(${set.id})|">Изтрий</span>
        </div>

        <!-- Add New Set -->
        <div class="mt-3">
            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addSetModal">Добави серия</button>
        </div>
    </div>

    <!-- Add Set Modal -->
    <div class="modal fade" id="addSetModal" tabindex="-1" aria-labelledby="addSetModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addSetModalLabel">Добави нова серия</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label for="setWeight" class="form-label">Тежест (kg)</label>
                            <input type="number" class="form-control" id="setWeight" required />
                        </div>
                        <div class="mb-3">
                            <label for="setReps" class="form-label">Повторения (Reps)</label>
                            <input type="number" class="form-control" id="setReps" required />
                        </div>
                        <div class="mb-3">
                            <label for="setRpe" class="form-label">RPE</label>
                            <input type="number" class="form-control" id="setRpe" required />
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Затвори</button>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" onclick="addSet()">Запази</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Exercise Button -->
    <div class="mt-3">
        <button class="btn btn-outline-success">Добави Упражнение</button>
    </div>
</div>

<!-- Връзка към WebJars JavaScript файловете (Bootstrap JS и Popper) -->
<script src="@{webjars/popper.js/2.11.7/umd/popper.min.js}"></script>
<script src="@{webjars/bootstrap/5.3.5/js/bootstrap.min.js}"></script>

<script>
    // Таймер код
    let timerInterval;
    let timeRemainingInSeconds;

    function updateTimerDisplay(minutes, seconds) {
        document.getElementById('restTimer').textContent = `${minutes}min ${seconds}s`;
    }

    function startTimer() {
        const minutes = parseInt(document.getElementById('minutesInput').value) || 0;
        const seconds = parseInt(document.getElementById('secondsInput').value) || 0;

        timeRemainingInSeconds = (minutes * 60) + seconds;

        if (timerInterval) {
            clearInterval(timerInterval);  // Спираме стария таймер, ако има такъв
        }

        timerInterval = setInterval(() => {
            const minutesLeft = Math.floor(timeRemainingInSeconds / 60);
            const secondsLeft = timeRemainingInSeconds % 60;

            updateTimerDisplay(minutesLeft, secondsLeft);

            // Намаляваме времето с 1 секунда
            if (timeRemainingInSeconds > 0) {
                timeRemainingInSeconds--;
            } else {
                clearInterval(timerInterval);  // Спираме таймера, когато времето изтече
                alert('Таймерът изтече!');
            }
        }, 1000); // Обновяваме на всеки 1 секунда
    }
</script>
<div th:replace="fragments/bootstrap-js :: bootstrap-js"></div>
</body>
</html>
