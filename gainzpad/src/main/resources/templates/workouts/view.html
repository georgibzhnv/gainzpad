<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head th:replace="~{fragments/head :: head}"></head>
<body>
<div class="container mt-4">
  <h2 th:text="${workout.workoutName}">Workout Name</h2>

  <div class="mb-3">
    <form th:action="@{/workouts/start/{id}(id=${workout.id})}" method="post" th:if="${workout.startTime == null}">
      <button type="submit" class="btn btn-primary">Start routine</button>
    </form>
    <form th:action="@{/workouts/finish/{id}(id=${workout.id})}" method="post" th:if="${workout.startTime != null and workout.endTime == null}">
      <button type="submit" class="btn btn-danger">Finish</button>
    </form>
    <span th:if="${workout.endTime != null}" class="badge bg-success">Routine is finished.</span>
  </div>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th>Exercise</th>
      <th>Set №</th>
      <th>Reps</th>
      <th>Weight (kg)</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <th:block th:each="we : ${workout.exercises}">
      <th:block th:each="set, setStat : ${we.sets}">
        <form th:action="@{/workouts/{workoutId}/exercise/{exerciseId}/recordSet(workoutId=${workout.id},exerciseId=${we.exerciseId})}" method="post">
          <tr>
            <td th:if="${setStat.index == 0}" th:rowspan="${#lists.size(we.sets)}" th:text="${we.exerciseName}"></td>
            <td th:text="${setStat.index + 1}"></td>
            <td>
              <input type="hidden" name="setId" th:value="${set.id}" />
              <input type="number" name="reps" th:value="${set.reps}" min="0" class="form-control form-control-sm" />
            </td>
            <td>
              <input type="number" name="weight" th:value="${set.weight}" min="0" class="form-control form-control-sm" />
            </td>
            <td>
              <span th:text="${set.completed} ? 'Completed' : 'Not completed'"></span>
            </td>
            <td>
              <button type="submit" class="btn btn-success btn-sm"
                      th:if="${!set.completed and workout.startTime != null and workout.endTime == null}">
                Done
              </button>
              <span th:if="${set.completed}" class="text-success">✔</span>
            </td>
          </tr>
        </form>
      </th:block>
    </th:block>
    </tbody>

  </table>
  <a th:href="@{/workouts}" class="btn btn-secondary">Return to list</a>
</div>
<div th:replace="~{fragments/bootstrap-js::bootstrap-js}"></div>
</body>
</html>
